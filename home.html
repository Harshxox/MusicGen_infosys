<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Music Composer ‚Äî Home</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

    /* ========== Your original palette (unchanged) ========== */
    :root{
      --bg-dark: #1a1625;
      --bg-darker: #0f0a1a;
      --bg-card: #221a2e;
      --accent-primary: #a855f7;
      --accent-secondary: #ec4899;
      --accent-glow: rgba(168, 85, 247, 0.3);
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border-subtle: rgba(168, 85, 247, 0.15);
      --surface-elevated: rgba(168, 85, 247, 0.05);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial; color: var(--text-primary); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    body { background: var(--bg-darker); position: relative; overflow-x: hidden; }

    /* ========== MUSIC POSTERS BACKGROUND ========== */
    .bg-wrap { position: fixed; inset: 0; z-index: -3; overflow: hidden; }

    /* soft gradient wash to unify posters with your palette */
    .bg-wash {
      position: absolute; inset: -20%;
      background:
        radial-gradient(60% 60% at 20% 20%, rgba(168,85,247,.18), transparent 60%),
        radial-gradient(60% 60% at 80% 80%, rgba(236,72,153,.14), transparent 60%),
        /* slightly deeper wash ‚Üí tweak the last two alphas to adjust strength */
        linear-gradient(180deg, rgba(10,8,20,.78), rgba(10,8,20,.92)); /* ‚Üê adjust here */
      pointer-events: none; z-index: 1;
      mix-blend-mode: screen;
    }

    /* floating single posters (random positions) */
    .bg-posters {
      position: absolute; inset: -10% -10% -10% -10%;
      filter: saturate(1.05) contrast(1.02) brightness(.9);
      z-index: 0;
    }
    .poster {
      position: absolute;
      width: var(--size, 160px); height: var(--size, 160px);
      border-radius: 14px;
      box-shadow:
        0 10px 30px rgba(0,0,0,.45),
        0 0 0 1px rgba(255,255,255,.06) inset;
      transform: translate3d(0,0,0) rotate(var(--rot, 0deg));
      animation: float var(--dur, 24s) ease-in-out infinite;
      will-change: transform;
      overflow: hidden;
      background: #0c0b14;
      outline: 1px solid rgba(168, 85, 247, .12);
      opacity: .22; /* ‚Üê posters softer (was 1). Adjust 0.18‚Äì0.3 to taste */
    }
    .poster img {
      width: 100%; height: 100%; object-fit: cover; display: block;
      filter: drop-shadow(0 6px 20px rgba(168,85,247,.12));
    }
    @keyframes float {
      0%   { transform: translate3d(var(--x0,0), var(--y0,0), 0) rotate(var(--rot,0deg)) scale(1); }
      50%  { transform: translate3d(calc(var(--x0,0) + var(--dx, 80px)), calc(var(--y0,0) + var(--dy, -60px)), 0) rotate(calc(var(--rot,0deg) + var(--dr, 6deg))) scale(1.03); }
      100% { transform: translate3d(var(--x0,0), var(--y0,0), 0) rotate(var(--rot,0deg)) scale(1); }
    }

    /* marquee belts (Suno-ish bands of posters sliding across) */
    .marquee {
      position: absolute; left: -10vw; right: -10vw;
      display: flex; gap: 24px; padding: 12px 0;
      will-change: transform;
      mask-image: linear-gradient(90deg, transparent 0%, #000 12%, #000 88%, transparent 100%);
      -webkit-mask-image: linear-gradient(90deg, transparent 0%, #000 12%, #000 88%, transparent 100%);
      z-index: 2;
      opacity: .22; /* ‚Üê belts softer (was .9). Adjust 0.18‚Äì0.3 to taste */
    }
    .marquee .tile {
      width: 120px; height: 120px; border-radius: 14px; flex: 0 0 auto;
      overflow: hidden; box-shadow: 0 8px 28px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset;
      outline: 1px solid rgba(168, 85, 247, .14);
      background: #0c0b14;
    }
    .marquee .tile img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .marquee.top    { top: 18%; transform: translateX(0); animation: scrollLeft 32s linear infinite; }
    .marquee.bottom { bottom: 14%; transform: translateX(0); animation: scrollRight 36s linear infinite; /* no extra opacity override */ }
    @keyframes scrollLeft  { to { transform: translateX(-50%); } }
    @keyframes scrollRight { to { transform: translateX(50%);  } }

    /* subtle noise/grain for texture */
    .bg-noise {
      position: absolute; inset: 0; z-index: 3; pointer-events: none; opacity: .06;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.35"/></svg>');
      background-size: 140px 140px; mix-blend-mode: soft-light;
    }

    /* Accessibility: reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .poster, .marquee { animation: none !important; }
    }

    /* ========== Header (unchanged) ========== */
    .header { position: fixed; top: 0; left: 0; right: 0; padding: 20px 40px; display: flex; align-items: center; justify-content: space-between; background: rgba(15, 10, 26, 0.6); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border-subtle); z-index: 100; }
    .logo-section { display: flex; align-items: center; gap: 12px; }
    .logo { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 24px; color: white; box-shadow: 0 8px 24px var(--accent-glow); }
    .logo-text h1 { font-size: 20px; font-weight: 800; color: var(--text-primary); letter-spacing: -0.02em; }
    .logo-text p { font-size: 12px; color: var(--text-muted); font-weight: 500; }

    /* ========== Main layout (your sections, untouched) ========== */
    .container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 120px 40px 60px; position: relative; }
    .main-card { width: 100%; max-width: 1400px; display: grid; grid-template-columns: 1.5fr 1fr; gap: 60px; align-items: center; animation: card-entrance 1s cubic-bezier(.16,1,.3,1); }
    @keyframes card-entrance { from{opacity:0;transform:translateY(40px)} to{opacity:1;transform:translateY(0)} }

    .content-section { display: flex; flex-direction: column; gap: 32px; }
    .badge { display: inline-flex; gap: 8px; padding: 8px 20px; border-radius: 10px; background: var(--surface-elevated); border: 1px solid var(--border-subtle); font-weight: 600; font-size: 12px; text-transform: uppercase; color: var(--accent-primary); width: fit-content; letter-spacing: 0.5px; }
    .badge-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-primary); animation: pulse-dot 2s infinite; box-shadow: 0 0 12px var(--accent-primary); }
    @keyframes pulse-dot { 0%,100%{opacity:1;transform:scale(1)}50%{opacity:.6;transform:scale(1.2)} }

    .hero-title { font-size: 64px; line-height: 1.1; font-weight: 900; color: var(--text-primary); letter-spacing: -0.03em; margin-bottom: 24px; }
    .hero-title .gradient-text { background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 10px 40px rgba(168,85,247,.15); }

    .desc { color: var(--text-secondary); font-size: 18px; line-height: 1.7; margin-bottom: 16px; max-width: 600px; }

    .features-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 40px; }
    .feature-item { display: flex; gap: 16px; padding: 24px; background: rgba(34, 26, 46, 0.75); border-radius: 16px; border: 1px solid var(--border-subtle); transition: all .3s; box-shadow: 0 10px 40px rgba(0,0,0,.25); }
    .feature-item:hover { background: rgba(168, 85, 247, 0.08); border-color: var(--accent-primary); transform: translateY(-4px); box-shadow: 0 18px 48px rgba(168, 85, 247, 0.18); }
    .feature-icon { width: 48px; height: 48px; min-width: 48px; border-radius: 12px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2)); display: flex; align-items: center; justify-content: center; font-size: 24px; border: 1px solid var(--border-subtle); }
    .feature-text { display: flex; flex-direction: column; gap: 4px; }
    .feature-text strong { font-size: 16px; font-weight: 700; color: var(--text-primary); }
    .feature-text span { font-size: 14px; color: var(--text-muted); line-height: 1.5; }

    .auth-section { background: rgba(34, 26, 46, 0.72); padding: 48px; border-radius: 24px; border: 1px solid var(--border-subtle); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); position: relative; overflow: hidden; }
    .auth-section::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 50% 0%, rgba(168, 85, 247, 0.18), transparent 70%); pointer-events: none; }
    .auth-header { text-align: center; margin-bottom: 36px; position: relative; z-index: 1; }
    .auth-logo { width: 80px; height: 80px; border-radius: 20px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 36px; color: white; margin: 0 auto 24px; box-shadow: 0 12px 36px var(--accent-glow); border: 1px solid rgba(255,255,255,.12); }
    .auth-title { font-size: 32px; font-weight: 900; margin-bottom: 8px; color: var(--text-primary); letter-spacing: -0.02em; }
    .auth-subtitle { color: var(--text-secondary); font-size: 15px; }

    .auth-form { display: flex; flex-direction: column; gap: 16px; position: relative; z-index: 1; }
    .btn { appearance: none; border: none; padding: 18px 32px; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; transition: all .3s; position: relative; overflow: hidden; font-family: inherit; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn::before { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transform: translateX(-100%); transition: transform .6s; }
    .btn:hover::before { transform: translateX(100%); }
    .btn:hover { transform: translateY(-2px); }
    .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; box-shadow: 0 8px 24px var(--accent-glow); }
    .btn-primary:hover { box-shadow: 0 12px 32px var(--accent-glow); }
    .btn-secondary { background: rgba(168, 85, 247, 0.1); color: var(--text-primary); border: 1px solid var(--border-subtle); }
    .btn-secondary:hover { background: rgba(168, 85, 247, 0.15); border-color: var(--accent-primary); }

    .divider { display: flex; align-items: center; gap: 16px; margin: 8px 0; }
    .divider-line { flex: 1; height: 1px; background: var(--border-subtle); }
    .divider-text { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }

    .auth-footer { text-align: center; margin-top: 32px; font-size: 13px; color: var(--text-muted); line-height: 1.6; position: relative; z-index: 1; }

    .tech-badge { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: rgba(168, 85, 247, 0.08); border: 1px solid var(--border-subtle); border-radius: 12px; font-size: 13px; color: var(--text-secondary); margin-top: 32px; }
    .tech-badge svg { width: 20px; height: 20px; }

    /* ========== Modal (unchanged) ========== */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(10, 14, 26, 0.9); backdrop-filter: blur(12px); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 1000; animation: fadeIn .3s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal { background: var(--bg-card); padding: 48px; border-radius: 24px; max-width: 480px; width: 100%; border: 1px solid var(--border-subtle); box-shadow: 0 24px 72px rgba(0, 0, 0, 0.7); animation: modalSlide .3s cubic-bezier(.16,1,.3,1); }
    @keyframes modalSlide { from{opacity:0;transform:translateY(-20px) scale(.96)} to{opacity:1;transform:translateY(0) scale(1)} }
    .modal h3 { font-size: 28px; margin-bottom: 32px; font-weight: 900; color: var(--text-primary); letter-spacing: -0.02em; }
    .field { display: flex; flex-direction: column; margin-bottom: 20px; }
    .field label { font-size: 13px; font-weight: 700; margin-bottom: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
    .field input { padding: 16px 18px; border-radius: 12px; border: 1px solid var(--border-subtle); background: rgba(168, 85, 247, 0.05); color: var(--text-primary); font-size: 15px; font-family: inherit; transition: all .3s; }
    .field input:focus { outline: none; border-color: var(--accent-primary); background: rgba(168, 85, 247, 0.08); box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1); }
    .modal-actions { display: flex; gap: 12px; margin-top: 28px; }
    .modal-actions .btn { flex: 1; }
    #modalError { color: #f87171; margin-top: 16px; font-size: 14px; display: none; padding: 14px 18px; background: rgba(248, 113, 113, 0.1); border-radius: 12px; border: 1px solid rgba(248, 113, 113, 0.2); }

    /* ========== Responsive ========== */
    @media (max-width: 1200px) { .main-card { grid-template-columns: 1fr; gap: 80px; } .hero-title { font-size: 56px; } }
    @media (max-width: 768px)  { .header { padding: 16px 24px; } .container { padding: 100px 24px 40px; } .hero-title { font-size: 42px; } .features-grid { grid-template-columns: 1fr; } .auth-section { padding: 36px 28px; } .modal { padding: 36px 28px; } }
    @media (max-width: 480px)  { .hero-title { font-size: 36px; } .desc { font-size: 16px; } .logo-text h1 { font-size: 18px; } }
  </style>
</head>
<body>
  <!-- ===== Live Music Poster Background ===== -->
  <div class="bg-wrap" aria-hidden="true">
    <div class="bg-posters" id="bgPosters"></div>

    <!-- Two marquee belts -->
    <div class="marquee top" id="marqueeTop" aria-hidden="true"></div>
    <div class="marquee bottom" id="marqueeBottom" aria-hidden="true"></div>

    <div class="bg-wash"></div>
    <div class="bg-noise"></div>
  </div>

  <!-- ===== Header ===== -->
  <header class="header">
    <div class="logo-section">
      <div class="logo">ùÑû‚®æìç¢÷¥‡ªã‡æÄ‡Ω≤</div>
      <div class="logo-text">
        <h1>AI Based Music Composer</h1>
        <p>Professional Studio Edition</p>
      </div>
    </div>
  </header>

  <!-- ===== Main ===== -->
  <main class="container">
    <section class="main-card" role="main">
      <div class="content-section">
        <div class="badge">
          <div class="badge-dot"></div>
          <span>AI-Powered Music Generation</span>
        </div>

        <h1 class="hero-title">
          AI-Based Music<br>
          <span class="gradient-text">Composition System</span>
        </h1>

        <p class="desc">
          Transform your ideas into expressive musical compositions using state-of-the-art AI technology. Experiment with diverse styles, moods, and instruments to bring your creative vision to life.
        </p>

        <div class="features-grid">
          <div class="feature-item">
            <div class="feature-icon">üéµ</div>
            <div class="feature-text">
              <strong>Instant Generation</strong>
              <span>Create professional music in seconds with advanced AI models</span>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üé®</div>
            <div class="feature-text">
              <strong>Style Diversity</strong>
              <span>Explore multiple genres, moods, and instrumental combinations</span>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üíæ</div>
            <div class="feature-text">
              <strong>Library Management</strong>
              <span>Save, organize, and manage your complete music collection</span>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">‚ö°</div>
            <div class="feature-text">
              <strong>High Quality Output</strong>
              <span>Professional-grade audio with crystal-clear production</span>
            </div>
          </div>
        </div>

        <div class="tech-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
          Powered by MusicGen & Transformer Architecture
        </div>
      </div>

      <aside class="auth-section" aria-label="Authentication">
        <div class="auth-header">
          <div class="auth-logo">ùÑû‚®æìç¢÷¥‡ªã‡æÄ‡Ω≤</div>
          <h2 class="auth-title">Welcome Back</h2>
          <p class="auth-subtitle">Sign in to access your music studio</p>
        </div>

        <div class="auth-form">
          <button id="signinBtn" class="btn btn-primary"><span>Login</span></button>

          <div class="divider">
            <div class="divider-line"></div>
            <span class="divider-text">Or</span>
            <div class="divider-line"></div>
          </div>

          <button id="signupBtn" class="btn btn-secondary"><span>Create Account</span></button>
        </div>

        <div class="auth-footer">
          <br>
          Your music and data are protected with enterprise-grade security.
        </div>
      </aside>
    </section>
  </main>

  <!-- ===== Auth Modal ===== -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <h3 id="modalTitle">Sign In</h3>
      <div class="field">
        <label for="email">Email Address</label>
        <input id="email" type="email" placeholder="you@example.com" />
      </div>
      <div class="field">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="Minimum 6 characters" />
      </div>
      <div class="modal-actions">
        <button id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button id="modalSubmit" class="btn btn-primary">Submit</button>
      </div>
      <div id="modalError"></div>
    </div>
  </div>

  <!-- ===== Firebase (Compat) ===== -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    /* ========= POSTER SOURCES =========
       Replace with your files inside /assets/albums/
       Tip: keep ~20+ images for smooth belts + floaters.
    */
    const POSTERS = [
      'assets/albums/album01.png',
      'assets/albums/album02.png',
      'assets/albums/album03.png',
      'assets/albums/album04.png',
      'assets/albums/album05.png',
      'assets/albums/album06.png',
      'assets/albums/album07.png',
      'assets/albums/album08.png',
      'assets/albums/album09.png',
      'assets/albums/album10.png',
      'assets/albums/album11.png',
      'assets/albums/album12.png'
    ];

    /* ========= Build floating posters ========= */
    const bgPosters = document.getElementById('bgPosters');

    function rand(min, max) { return Math.random() * (max - min) + min; }

    function addFloatingPosters() {
      const count = Math.min(36, Math.max(18, Math.floor((innerWidth * innerHeight) / 50000)));
      for (let i = 0; i < count; i++) {
        const src = POSTERS[i % POSTERS.length];
        const el = document.createElement('div');
        el.className = 'poster';

        // random props via CSS vars
        const size = Math.round(rand(110, 190));
        const x0 = Math.round(rand(-100, innerWidth + 100));
        const y0 = Math.round(rand(-120, innerHeight + 120));
        const dx = Math.round(rand(-120, 120));
        const dy = Math.round(rand(-90, 90));
        const rot = rand(-6, 6).toFixed(2) + 'deg';
        const dr  = rand(-8, 8).toFixed(2) + 'deg';
        const dur = rand(18, 32).toFixed(2) + 's';
        const delay = rand(-16, 0).toFixed(2) + 's';

        el.style.setProperty('--size', size + 'px');
        el.style.setProperty('--x0', x0 + 'px');
        el.style.setProperty('--y0', y0 + 'px');
        el.style.setProperty('--dx', dx + 'px');
        el.style.setProperty('--dy', dy + 'px');
        el.style.setProperty('--rot', rot);
        el.style.setProperty('--dr', dr);
        el.style.setProperty('--dur', dur);
        el.style.animationDelay = delay;
        el.style.left = x0 + 'px';
        el.style.top  = y0 + 'px';

        const img = new Image();
        img.loading = 'lazy';
        img.decoding = 'async';
        img.src = src;
        el.appendChild(img);
        bgPosters.appendChild(el);
      }
    }

    /* ========= Build marquee belts ========= */
    function buildMarquee(containerId, reverse=false) {
      const wrap = document.getElementById(containerId);
      // Need > 2x screen width for seamless loop
      const tilesNeeded = Math.ceil((innerWidth * 2) / 120) + 6;
      const sources = [];
      for (let i = 0; i < tilesNeeded; i++) {
        sources.push(POSTERS[i % POSTERS.length]);
      }
      const inner = document.createElement('div');
      inner.style.display = 'flex';
      inner.style.gap = '24px';
      inner.style.willChange = 'transform';

      sources.concat(sources).forEach(src => {
        const t = document.createElement('div');
        t.className = 'tile';
        const img = new Image();
        img.src = src; img.loading = 'lazy'; img.decoding = 'async';
        t.appendChild(img);
        inner.appendChild(t);
      });

      // Duplicate for smooth loop
      wrap.appendChild(inner.cloneNode(true));
      wrap.appendChild(inner);
      // Direction handled by CSS keyframes on .marquee
    }

    function initBackground() {
      if (!POSTERS.length) return;
      addFloatingPosters();
      buildMarquee('marqueeTop', false);
      buildMarquee('marqueeBottom', true);
    }

    // Respect reduced motion
    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
    if (!reduceMotion.matches) {
      window.addEventListener('load', initBackground, { once: true });
    } else {
      // Still render a sparse, static background
      const sparse = POSTERS.slice(0, 12);
      const bg = document.getElementById('bgPosters');
      sparse.forEach((src, i) => {
        const el = document.createElement('div');
        el.className = 'poster';
        el.style.setProperty('--size', (i % 2 ? 120 : 150) + 'px');
        el.style.left = (i * 8) + '%';
        el.style.top  = (i * 6) + '%';
        el.style.animation = 'none';
        const img = new Image(); img.src = src; img.loading = 'lazy';
        el.appendChild(img); bg.appendChild(el);
      });
    }

    /* ========= Your auth (unchanged) ========= */
    const MAIN_PAGE = 'index.html';
    const BACKEND_BASE = "http://localhost:8000";

    const firebaseConfig = {
      apiKey: "AIzaSyCErSFyAbprG4CS9tgMr5EzVOdj6MwN1vI",
      authDomain: "my-login-site-b774e.firebaseapp.com",
      projectId: "my-login-site-b774e",
      storageBucket: "my-login-site-b774e.firebasestorage.app",
      messagingSenderId: "179544210789",
      appId: "1:179544210789:web:1e38023701f55c848bb58c",
      measurementId: "G-TY76TYVMSB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const signinBtn = document.getElementById('signinBtn');
    const signupBtn = document.getElementById('signupBtn');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalCancel = document.getElementById('modalCancel');
    const modalSubmit = document.getElementById('modalSubmit');
    const modalError = document.getElementById('modalError');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    let currentMode = 'signin';

    function openModal(mode) {
      currentMode = mode;
      modalTitle.textContent = mode === 'signin' ? 'Sign In' : 'Create Account';
      modalSubmit.textContent = mode === 'signin' ? 'Sign In' : 'Create Account';
      modalError.style.display = 'none';
      modalError.textContent = '';
      emailInput.value = '';
      passwordInput.value = '';
      modal.style.display = 'flex';
      emailInput.focus();
    }
    function closeModal() { modal.style.display = 'none'; }

    modalCancel.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    [emailInput, passwordInput].forEach(inp => inp.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleEmailAuth();
    }));

    signinBtn.addEventListener('click', () => openModal('signin'));
    signupBtn.addEventListener('click', () => openModal('signup'));
    modalSubmit.addEventListener('click', handleEmailAuth);

    async function handleEmailAuth() {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) {
        modalError.textContent = 'Please enter email and password.';
        modalError.style.display = 'block';
        return;
      }
      modalSubmit.disabled = true;
      modalSubmit.textContent = 'Processing...';
      modalError.style.display = 'none';
      modalError.textContent = '';
      try {
        if (currentMode === 'signin') {
          await auth.signInWithEmailAndPassword(email, password);
        } else {
          await auth.createUserWithEmailAndPassword(email, password);
        }
      } catch (err) {
        modalError.textContent = err.message || 'Authentication failed';
        modalError.style.display = 'block';
        modalSubmit.disabled = false;
        modalSubmit.textContent = currentMode === 'signin' ? 'Sign In' : 'Create Account';
      }
    }

    auth.onAuthStateChanged((user) => {
      if (user) { window.location.href = MAIN_PAGE; }
    });

    async function signOutUser() {
      try {
        await firebase.auth().signOut();
        window.location.href = 'home.html';
      } catch (err) {
        console.error('Sign out failed', err);
      }
    }
  </script>
</body>
</html>
